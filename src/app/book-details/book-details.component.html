<div class="rtl book-details-container p-4 max-w-4xl mx-auto pt-40">
  <div *ngIf="loading" class="text-center text-gray-500 dark:text-gray-400">جارٍ تحميل بيانات الكتاب...</div>
  <div *ngIf="error" class="text-center text-red-600 dark:text-red-500 font-bold">{{ error }}</div>
  <div *ngIf="book" class="bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-lg p-6 relative">
    <h2 class="text-3xl font-bold mb-4 mt-1 text-gray-900 dark:text-gray-100">{{ book.product_name }}</h2>
        <!-- شريط الخصم -->
        <div class="absolute top-2 right-2 bg-red-600 dark:bg-red-700 text-white text-xs font-bold px-2 py-1 rounded shadow-md dark:shadow-lg z-10">
          {{ book.product_discount_percent }}% خصم
        </div>
        <div class="relative inline-block">
<img [src]="uploadsBaseUrl + '/' + book.product_image + '.jpg'" alt="{{ book.product_name }}" (error)="handleImageError($event)" class="w-64 h-auto mb-4 mx-auto rounded-lg shadow-md dark:shadow-lg" />
          <button (click)="copyBookLink()" title="نسخ رابط الكتاب" class="absolute top-2 right-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-full p-2 shadow-md dark:shadow-lg">
            <fa-icon [icon]="faShareAlt" class="text-gray-700 dark:text-gray-300 h-5 w-5"></fa-icon>
          </button>
        </div>
        
        <!-- رسالة تأكيد النسخ -->
        <div *ngIf="showCopySuccess" class="fixed top-20 right-10 bg-green-500 text-white px-4 py-2 rounded shadow-lg z-50">
          تم نسخ الرابط
        </div>
        
        <!-- السعر -->
        <div class="flex items-center space-x-2 mb-2">
          <p class="text-green-600 dark:text-green-400 font-bold text-lg mb-2">{{ book.product_price }} EGP</p>
          <p class="text-gray-400 dark:text-gray-500 line-through text-sm mb-2">
            {{ (book.product_price * 1.75) | number:'1.0-0' }} EGP
          </p>
        </div>
    <p class="mb-2 text-gray-900 dark:text-gray-100"><strong>الكمية المتوفرة:</strong> {{ book.product_quantity }}</p>
    <p class="mb-2 text-gray-900 dark:text-gray-100"><strong>التصنيف:</strong> {{ book.product_category }}</p>

    <!-- New product description section -->
    <div *ngIf="book.product_description" class="mb-4 text-gray-800 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded p-4 bg-gray-50 dark:bg-gray-700">
      <h3 class="text-xl font-semibold mb-2">وصف المنتج</h3>
      <p class="whitespace-pre-line">{{ book.product_description }}</p>
    </div>

    <!-- Average Rating Display -->
    <div class="mb-2 flex items-center space-x-2">
      <ng-container *ngFor="let star of [1,2,3,4,5]">
        <fa-icon *ngIf="star <= roundedAverageRating()" [icon]="faStar" class="text-yellow-400 h-5 w-5"></fa-icon>
        <fa-icon *ngIf="star > roundedAverageRating()" [icon]="faStarRegular" class="text-gray-300 dark:text-gray-600 h-5 w-5"></fa-icon>
      </ng-container>
      <span class="text-sm text-gray-600 dark:text-gray-300">({{ ratingCount }} تقييم)</span>
    </div>

<span *ngIf="book.product_quantity == 0" class="text-gray-900 dark:text-gray-100">
  هذا الكتاب غير متوفر حالياً<br>
  <span class="text-gray-500 dark:text-gray-400 text-xs">متوقع توافره خلال 3-5 أيام عمل</span>
</span>
<button *ngIf="book.product_quantity > 0" (click)="onBuyNowClick()" class="bg-blue-600 dark:bg-[#0a1325] text-white px-4 py-1 rounded-lg hover:bg-blue-700 dark:hover:bg-blue-800 transition">
  شراء الآن
</button>
  </div>
</div>

<div *ngIf="showLoginPrompt" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex justify-center items-center z-50">
  <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg dark:shadow-lg text-center">
    <h3 class="text-lg font-semibold mb-4 text-gray-900 dark:text-gray-100">يرجى تسجيل الدخول أولاً</h3>
    <p class="mb-4 text-gray-900 dark:text-gray-100">لإضافة الكتب إلى السلة أو المفضلة، يجب عليك تسجيل الدخول أو إنشاء حساب جديد.</p>
    <div class="flex justify-center gap-4">
      <button (click)="closeLoginPrompt()" class="bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg">إغلاق</button>
      <button (click)="openAccountModal()" class="bg-blue-500 dark:bg-[#0a1325] text-white px-4 py-2 rounded-lg hover:bg-blue-700 dark:hover:bg-blue-800">تسجيل الدخول أو إنشاء حساب</button>
    </div>
  </div>
</div>

<app-account-modal #accountModal></app-account-modal>

<app-checkout-modal 
  *ngIf="showCheckoutModal"
  [bookId]="book?.products_id"
  (close)="showCheckoutModal = false">
</app-checkout-modal>
