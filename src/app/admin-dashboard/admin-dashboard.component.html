<h2 class="text-3xl font-extrabold mb-6 pt-40 text-center text-blue-700 dark:text-blue-400">لوحة تحكم الأدمن</h2>

<div class="flex justify-center space-x-4 mb-6">
  <button (click)="switchView('orders')" [class.bg-blue-600]="currentView === 'orders'" class="px-4 py-2 rounded text-white bg-blue-400 hover:bg-blue-600  transition">
    الطلبات
  </button>
  <button (click)="switchView('requestedBooks')" [class.bg-blue-600]="currentView === 'requestedBooks'" class="px-4 py-2 rounded text-white bg-blue-400 hover:bg-blue-600  transition">
    اقتراحات الكتب
  </button>
  <button (click)="switchView('printOrders')" [class.bg-blue-600]="currentView === 'printOrders'" class="px-4 py-2 rounded text-white bg-blue-400 hover:bg-blue-600  transition">
    طلبات الطباعة
  </button>
  <button (click)="switchView('addProduct')" [class.bg-blue-600]="currentView === 'addProduct'" class="px-4 py-2 rounded text-white bg-blue-400 hover:bg-blue-600  transition">
    إضافة منتج جديد
  </button>
  <button (click)="switchView('products')" [class.bg-blue-600]="currentView === 'products'" class="px-4 py-2 rounded text-white bg-blue-400 hover:bg-blue-600  transition">
    عرض وتعديل المنتجات
  </button>
</div>

<div *ngIf="currentView === 'addProduct'" class="px-4 sm:px-10 max-w-3xl mx-auto">
  <h3 class="text-xl font-bold mb-4 text-gray-900 dark:text-gray-200">إضافة منتج جديد</h3>
<form (ngSubmit)="submitAddProduct()" #addProductForm="ngForm" enctype="multipart/form-data" class="space-y-4">
    <div>
      <label for="image" class="block mb-1 font-semibold">صورة المنتج</label>
      <input
        type="file"
        id="image"
        (change)="onFileSelected($event)"
        accept="image/*"
        required
        [ngClass]="{
          'border-red-500': imageError,
          'border-blue-500': !imageError && selectedFile
        }"
        class="w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-gray-200"
      />
      <p *ngIf="imageError" class="text-red-500 text-sm mt-1 dark:text-red-400">{{ imageError }}</p>
    </div>
    <!-- Removed barcode input as barcode is generated on backend -->
    <div>
      <label for="product_name" class="block mb-1 font-semibold">اسم المنتج</label>
      <input
        type="text"
        id="product_name"
        [(ngModel)]="product.product_name"
        name="product_name"
        required
        #productName="ngModel"
        [ngClass]="{
          'border-red-500': productName.invalid && (productName.dirty || productName.touched),
          'border-blue-500': productName.valid && (productName.dirty || productName.touched)
        }"
        class="w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-gray-200"
      />
      <p *ngIf="productName.invalid && (productName.dirty || productName.touched)" class="text-red-500 text-sm mt-1 dark:text-red-400">
        يرجى إدخال اسم المنتج.
      </p>
    </div>
    <div>
      <label for="product_quantity" class="block mb-1 font-semibold">الكمية</label>
      <input
        type="number"
        id="product_quantity"
        [(ngModel)]="product.product_quantity"
        name="product_quantity"
        required
        min="1"
        #productQuantity="ngModel"
        [ngClass]="{
          'border-red-500': productQuantity.invalid && (productQuantity.dirty || productQuantity.touched),
          'border-blue-500': productQuantity.valid && (productQuantity.dirty || productQuantity.touched)
        }"
        class="w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-gray-200"
      />
      <p *ngIf="productQuantity.invalid && (productQuantity.dirty || productQuantity.touched)" class="text-red-500 text-sm mt-1 dark:text-red-400">
        يرجى إدخال كمية صحيحة (1 أو أكثر).
      </p>
    </div>
    <div>
      <label for="product_category" class="block mb-1 font-semibold">الفئة</label>
      <select
        id="product_category"
        [(ngModel)]="product.product_category"
        name="product_category"
        required
        #productCategory="ngModel"
        [ngClass]="{
          'border-red-500': productCategory.invalid && (productCategory.dirty || productCategory.touched),
          'border-blue-500': productCategory.valid && (productCategory.dirty || productCategory.touched)
        }"
        class="w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-gray-200"
      >
        <option value="" disabled>اختر الفئة</option>
        <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
      </select>
      <p *ngIf="productCategory.invalid && (productCategory.dirty || productCategory.touched)" class="text-red-500 text-sm mt-1 dark:text-red-400">
        يرجى اختيار الفئة.
      </p>
    </div>
    <div>
      <label for="product_price" class="block mb-1 font-semibold">سعر البيع</label>
      <input
        type="number"
        id="product_price"
        [(ngModel)]="product.product_price"
        name="product_price"
        required
        min="0"
        step="0.01"
        #productPrice="ngModel"
        [ngClass]="{
          'border-red-500': productPrice.invalid && (productPrice.dirty || productPrice.touched),
          'border-blue-500': productPrice.valid && (productPrice.dirty || productPrice.touched)
        }"
        class="w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-gray-200"
      />
      <p *ngIf="productPrice.invalid && (productPrice.dirty || productPrice.touched)" class="text-red-500 text-sm mt-1 dark:text-red-400">
        يرجى إدخال سعر بيع صحيح.
      </p>
    </div>
    <div>
      <label for="price_cost" class="block mb-1 font-semibold">سعر الشراء</label>
      <input
        type="number"
        id="price_cost"
        [(ngModel)]="product.price_cost"
        name="price_cost"
        required
        min="0"
        step="0.01"
        #priceCost="ngModel"
        [ngClass]="{
          'border-red-500': priceCost.invalid && (priceCost.dirty || priceCost.touched),
          'border-blue-500': priceCost.valid && (priceCost.dirty || priceCost.touched)
        }"
        class="w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-gray-200"
      />
      <p *ngIf="priceCost.invalid && (priceCost.dirty || priceCost.touched)" class="text-red-500 text-sm mt-1 dark:text-red-400">
        يرجى إدخال سعر شراء صحيح.
      </p>
    </div>
    <div>
      <label for="product_description" class="block mb-1 font-semibold">وصف المنتج</label>
      <textarea
        id="product_description"
        [(ngModel)]="product.product_description"
        name="product_description"
        rows="4"
        required
        #productDescription="ngModel"
        [ngClass]="{
          'border-red-500': productDescription.invalid && (productDescription.dirty || productDescription.touched),
          'border-blue-500': productDescription.valid && (productDescription.dirty || productDescription.touched)
        }"
        class="w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-gray-200"
      ></textarea>
      <p *ngIf="productDescription.invalid && (productDescription.dirty || productDescription.touched)" class="text-red-500 text-sm mt-1 dark:text-red-400">
        يرجى إدخال وصف المنتج.
      </p>
    </div>
    <button
      type="submit"
      [disabled]="!addProductForm.form.valid || !selectedFile || imageError"
      class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded"
    >
      إضافة المنتج
    </button>
  </form>
</div>

<div *ngIf="currentView === 'products'" class="px-4 sm:px-10 max-w-6xl mx-auto">
  <h3 class="text-xl font-bold mb-4 text-gray-900 dark:text-gray-200">عرض وتعديل المنتجات</h3>
  <!-- Search bar for filtering products -->
  <div class="mb-4">
    <input
      type="text"
      placeholder="ابحث عن منتج..."
      [(ngModel)]="searchTerm"
      (input)="onSearchTermChange()"
      class="w-full border rounded px-3 py-2 dark:bg-gray-700 dark:text-gray-200"
    />
  </div>
  <div class="overflow-x-auto">
    <table class="min-w-full bg-white dark:bg-gray-800 rounded-lg shadow-md text-sm mx-auto">
      <thead>
        <tr class="bg-blue-100 dark:bg-[#0a1325] text-blue-700 dark:text-blue-400 uppercase text-xs font-semibold">
          <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">صورة المنتج</th>
          <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">اسم المنتج</th>
          <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">الكمية</th>
          <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">الفئة</th>
          <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">الوصف</th>
          <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">سعر البيع</th>
          <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">سعر الشراء</th>
          <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">تعديل الصورة</th>
          <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">إجراءات</th>
        </tr>
      </thead>
      <tbody *ngIf="products.length > 0">
        <tr *ngFor="let product of products; let i = index" [ngClass]="{'bg-blue-50 dark:bg-[#0a1325]': i % 2 === 0, 'bg-white dark:bg-gray-800': i % 2 !== 0}">
          <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">
<img *ngIf="product.product_image" [src]="uploadsBaseUrl + '/' + product.product_image" alt="صورة المنتج" class="w-16 h-16 object-cover mx-auto rounded" (error)="handleImageError($event)" />
            <span *ngIf="!product.product_image">لا توجد صورة</span>
          </td>
          <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">
            <input [(ngModel)]="product.product_name" class="w-full border rounded px-2 py-1 dark:bg-gray-700 dark:text-gray-200" />
          </td>
          <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">
            <input type="number" [(ngModel)]="product.product_quantity" min="0" class="w-full border rounded px-2 py-1 dark:bg-gray-700 dark:text-gray-200" />
          </td>
          <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">
            <select [(ngModel)]="product.product_category" class="w-full border rounded px-2 py-1 dark:bg-gray-700 dark:text-gray-200">
              <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
            </select>
          </td>
          <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">
            <textarea [(ngModel)]="product.product_description" rows="2" class="w-full border rounded px-2 py-1 dark:bg-gray-700 dark:text-gray-200"></textarea>
          </td>
          <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">
            <input type="number" [(ngModel)]="product.product_price" min="0" step="0.01" class="w-full border rounded px-2 py-1 dark:bg-gray-700 dark:text-gray-200" />
          </td>
          <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">
            <input type="number" [(ngModel)]="product.price_cost" min="0" step="0.01" class="w-full border rounded px-2 py-1 dark:bg-gray-700 dark:text-gray-200" />
          </td>
          <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">
            <input type="file" (change)="replaceProductImage(product, $any($event.target).files ? $any($event.target).files[0] : null)" accept="image/*" class="w-full" />
          </td>
          <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">
            <button (click)="updateProduct(product)" [disabled]="!hasProductChanged(product)" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1 px-3 rounded disabled:opacity-50">
              حفظ
            </button>
            <button (click)="deleteProduct(product)" class="ml-2 bg-red-600 hover:bg-red-700 text-white font-semibold py-1 px-3 rounded">
              حذف
            </button>
          </td>
        </tr>
      </tbody>
      <p *ngIf="products.length === 0" class="text-center text-gray-500 dark:text-gray-400 py-6">لا توجد منتجات حالياً</p>
    </table>
  </div>

  <!-- Pagination controls for products -->
  <div class="flex justify-center mt-4 space-x-4 items-center">
    <button (click)="prevProductsPage()" [disabled]="productsPage === 1" class="px-3 py-1 bg-gray-300 dark:bg-gray-600 rounded disabled:opacity-50">السابق</button>
    <span class="text-gray-900 dark:text-gray-200">صفحة {{ productsPage }} من {{ totalProductsPages() }}</span>
    <button (click)="nextProductsPage()" [disabled]="productsPage === totalProductsPages()" class="px-3 py-1 bg-gray-300 dark:bg-gray-600 rounded disabled:opacity-50">التالي</button>
  </div>
</div>

<!-- Floating upload progress indicator -->
<div *ngIf="uploading || uploadSuccess" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
  <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-80 max-w-full text-center shadow-lg">
    <div *ngIf="uploading" class="text-blue-600 dark:text-blue-400 font-semibold">
      جاري الرفع... {{ uploadProgress }}%
      <div class="w-full bg-gray-200 rounded-full h-4 mt-2">
        <div class="bg-blue-600 h-4 rounded-full transition-all duration-300 ease-in-out" [style.width.%]="uploadProgress"></div>
      </div>
    </div>
    <div *ngIf="uploadSuccess" class="text-green-600 dark:text-green-400 font-semibold flex flex-col items-center space-y-2">
      <fa-icon [icon]="['fas', 'check-circle']" class="text-6xl animate-scale-up"></fa-icon>
      <div>تم الرفع بنجاح!</div>
    </div>
  </div>
</div>

<!-- عرض الطلبات -->
<div *ngIf="currentView === 'orders'">
  <div class="px-2 sm:px-10">

    <!-- تصميم عرض الطلبات في الشاشات الصغيرة -->
    <div class="sm:hidden space-y-6">
      <div *ngFor="let order of orders; let orderIndex = index" class="bg-white shadow-md rtl rounded-lg p-4 space-y-3 dark:bg-gray-800" [ngClass]="{'bg-blue-50 dark:bg-[#0a1325]': orderIndex % 2 === 0, 'bg-white dark:bg-gray-800': orderIndex % 2 !== 0}">
        <div><strong>اسم العميل:</strong> {{ order.customerName }}</div>
        <div><strong>البريد الإلكتروني:</strong> {{ order.email }}</div>
        <div><strong>العنوان:</strong> {{ order.address }}</div>
        <div><strong>رقم الطلب:</strong> {{ order._id }}</div>
        <div><strong>تاريخ الطلب:</strong> {{ formatOrderDate(order.orderDate) }}</div>
        <div><strong>الحالة:</strong>
          <span class="inline-block px-2 py-1 rounded-full text-xs font-semibold" [ngClass]="{
            'text-yellow-500': order.status === 'قيد الإنتظار',
            'text-orange-500': order.status === 'تم الشحن',
            'text-green-500': order.status === 'تم التسليم',
            'text-red-500': order.status === 'تم الإلغاء',
            'dark:text-yellow-400': order.status === 'قيد الإنتظار',
            'dark:text-orange-400': order.status === 'تم الشحن',
            'dark:text-green-400': order.status === 'تم التسليم',
            'dark:text-red-400': order.status === 'تم الإلغاء'
          }">
            {{ order.status }}
          </span>
        </div>

        <div>
          <strong>الكتب:</strong>
          <ul class="list-disc pr-5">
            <li *ngFor="let product of order.products">
              {{ product.product_name }} ({{ product.product_quantity }})
            </li>
          </ul>
        </div>
        <div><strong> السعر الإجمالي</strong> {{ order.totalAmount + ' ج.م' }}</div>
        <div class="flex gap-2 mt-2">
                  <button
                    *ngIf="order.status === 'قيد الإنتظار'"
                    (click)="confirmShipment(order._id, 'تم الشحن')"
                    class="w-full bg-orange-500 hover:bg-orange-600 dark:bg-orange-600 dark:hover:bg-orange-700 text-white font-semibold py-1 px-3 rounded">
                    اشحن
                  </button>
                  <button
                    *ngIf="order.status === 'تم الشحن'"
                    (click)="confirmShipment(order._id, 'تم التسليم')"
                    class="w-full bg-green-500 hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700 text-white font-semibold py-1 px-3 rounded">
                    تمت
                  </button>
                  <button
                    *ngIf="order.status !== 'تم الإلغاء' && order.status !== 'تم التسليم'"
                    (click)="confirmShipment(order._id, 'تم الإلغاء')"
                    class="w-full bg-red-700 hover:bg-red-800 dark:bg-red-700 dark:hover:bg-red-800 text-white font-semibold py-1 px-3 rounded">
                    إلغاء
                  </button>
                  <button
                    (click)="deleteOrder(order._id)"
                    class="w-full bg-gray-700 hover:bg-black dark:bg-gray-800 dark:hover:bg-black text-white font-semibold py-1 px-3 rounded">
                    حذف
                  </button>
        </div>
      </div>
    </div>

    <!-- تصميم الجدول للشاشات المتوسطة والكبيرة -->
    <div class="hidden sm:block overflow-x-auto">
      <table class="min-w-full bg-white dark:bg-gray-800 rounded-lg shadow-md text-sm mx-auto">
        <thead>
          <tr class="bg-blue-100 dark:bg-[#0a1325] text-blue-700 dark:text-blue-400 uppercase text-xs font-semibold">
            <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">بيانات العميل</th>
            <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">الكتب</th>
            <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">الكمية</th>
            <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">السعر الإجمالي</th>
            <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">الحالة</th>
            <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">تاريخ الطلب</th>
            <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">إجراءات</th>
          </tr>
        </thead>
        <tbody *ngIf="orders.length > 0">
          <ng-container *ngFor="let order of orders; let orderIndex = index">
            <tr [ngClass]="{'bg-blue-50 dark:bg-[#0a1325]': orderIndex % 2 === 0, 'bg-white dark:bg-gray-800': orderIndex % 2 !== 0}">
              <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700 rtl" [attr.rowspan]="order.products.length">
                <div><strong>اسم العميل:</strong> {{ order.customerName }}</div>
                <div><strong>البريد الإلكتروني:</strong> {{ order.email }}</div>
                <div><strong>العنوان:</strong> {{ order.address }}</div>
                <div><strong>رقم الطلب:</strong> {{ order._id }}</div>
              </td>
              <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">{{ order.products[0].product_name }}</td>
              <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">{{ order.products[0].product_quantity }}</td>
              <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700 rtl" [attr.rowspan]="order.products.length">
                {{ order.totalAmount + ' ج.م' }}
              </td>
              <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700" [attr.rowspan]="order.products.length">
                <span class="inline-block px-2 py-1 rounded-full text-xs font-semibold" [ngClass]="{
                  'text-yellow-500': order.status === 'قيد الإنتظار',
                  'text-orange-500': order.status === 'تم الشحن',
                  'text-green-500': order.status === 'تم التسليم',
                  'text-red-500': order.status === 'تم الإلغاء',
                  'dark:text-yellow-400': order.status === 'قيد الإنتظار',
                  'dark:text-orange-400': order.status === 'تم الشحن',
                  'dark:text-green-400': order.status === 'تم التسليم',
                  'dark:text-red-400': order.status === 'تم الإلغاء'
                }">
                  {{ order.status }}
                </span>
              </td>
              <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700" [attr.rowspan]="order.products.length">
                {{ formatOrderDate(order.orderDate) }}
              </td>
              <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700" [attr.rowspan]="order.products.length">
                <div class="flex gap-2 mt-2">
                  <button
                    *ngIf="order.status === 'قيد الإنتظار'"
                    (click)="confirmShipment(order._id, 'تم الشحن')"
                    class="w-full bg-orange-500 hover:bg-orange-600 dark:bg-orange-600 dark:hover:bg-orange-700 text-white font-semibold py-1 px-3 rounded">
                    اشحن
                  </button>

                  <button
                    *ngIf="order.status === 'تم الشحن'"
                    (click)="confirmShipment(order._id, 'تم التسليم')"
                    class="w-full bg-green-500 hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700 text-white font-semibold py-1 px-3 rounded">
                    تمت
                  </button>

                  <button
                    *ngIf="order.status !== 'تم الإلغاء' && order.status !== 'تم التسليم'"
                    (click)="confirmShipment(order._id, 'تم الإلغاء')"
                    class="w-full bg-red-700 hover:bg-red-800 dark:bg-red-700 dark:hover:bg-red-800 text-white font-semibold py-1 px-3 rounded">
                    إلغاء
                  </button>

                  <button
                    (click)="deleteOrder(order._id)"
                    class="w-full bg-gray-700 hover:bg-black dark:bg-gray-800 dark:hover:bg-black text-white font-semibold py-1 px-3 rounded">
                    حذف
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngFor="let product of order.products; let i = index" [hidden]="i === 0" [ngClass]="{'bg-blue-50 dark:bg-[#0a1325]': orderIndex % 2 === 0, 'bg-white dark:bg-gray-800': orderIndex % 2 !== 0}">
              <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">{{ product.product_name }}</td>
              <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">{{ product.product_quantity }}</td>
            </tr>
          </ng-container>
        </tbody>
  </table>

  <!-- Pagination controls for orders -->
  <div *ngIf="currentView === 'orders'" class="flex justify-center mt-4 space-x-4">
    <button (click)="ordersPage = ordersPage - 1; loadOrders()" [disabled]="ordersPage === 1" class="px-3 py-1 bg-gray-300 dark:bg-gray-600 rounded disabled:opacity-50">السابق</button>
    <span class="text-gray-900 dark:text-gray-200">صفحة {{ ordersPage }}</span>
    <button (click)="ordersPage = ordersPage + 1; loadOrders()" [disabled]="orders.length < ordersPageSize" class="px-3 py-1 bg-gray-300 dark:bg-gray-600 rounded disabled:opacity-50">التالي</button>
  </div>
</div>

    <p *ngIf="orders.length === 0" class="text-center text-gray-500 dark:text-gray-400 py-6">لا توجد طلبات حالياً</p>
  </div>
</div>

<!-- عرض اقتراحات الكتب -->
<div *ngIf="currentView === 'requestedBooks'" class="px-2 sm:px-10">
  <h3 class="text-xl font-bold mb-4 text-gray-900 dark:text-gray-200">اقتراحات المستخدمين للكتب</h3>
  <!-- Table for medium and larger screens -->
  <table class="min-w-full bg-white dark:bg-gray-800 rounded-lg shadow-md text-sm mx-auto hidden sm:table">
    <thead>
      <tr class="bg-blue-100 dark:bg-[#0a1325] text-blue-700 dark:text-blue-400 uppercase text-xs font-semibold">
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">اسم الكتاب</th>
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">اسم المؤلف</th>
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">صاحب الاقتراح</th>
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">تم أضافته</th>
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">تاريخ الطلب</th>
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">إجراءات</th>
      </tr>
    </thead>
    <tbody *ngIf="requestedBooks.length > 0">
      <tr *ngFor="let suggestion of requestedBooks; let i = index" [ngClass]="{'bg-blue-50 dark:bg-[#0a1325]': i % 2 === 0, 'bg-white dark:bg-gray-800': i % 2 !== 0}">
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">{{ suggestion.bookName }}</td>
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">{{ suggestion.authorName || 'غير محدد' }}</td>
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">{{ suggestion.username ? (suggestion.username + ' (' + suggestion.userId + ')') : 'غير معروف' }}</td>
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">
          <input type="checkbox" [checked]="suggestion.added" (click)="$event.preventDefault(); toggleAddedStatus(suggestion)" />
        </td>
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">{{ formatOrderDate(suggestion.dateRequested) }}</td>
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">
          <button (click)="deleteRequestedBook(suggestion._id, suggestion.userId)" class="bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 text-white px-3 py-1 rounded">
            حذف
          </button>
        </td>
      </tr>
    </tbody>
    <p *ngIf="requestedBooks.length === 0" class="text-center text-gray-500 dark:text-gray-400 py-6">لا توجد اقتراحات حالياً</p>
  </table>

  <!-- List for small screens -->
  <div class="sm:hidden space-y-4">
    <div *ngFor="let suggestion of requestedBooks; let i = index" [ngClass]="{'bg-blue-50 dark:bg-[#0a1325]': i % 2 === 0, 'bg-white dark:bg-gray-800': i % 2 !== 0}" class="rounded-lg p-4 shadow-md dark:shadow-lg">
      <div><strong>اسم الكتاب:</strong> {{ suggestion.bookName }}</div>
      <div><strong>اسم المؤلف:</strong> {{ suggestion.authorName || 'غير محدد' }}</div>
      <div><strong>صاحب الاقتراح:</strong> {{ suggestion.username ? (suggestion.username + ' (' + suggestion.userId + ')') : 'غير معروف' }}</div>
      <div>
        <strong>تم أضافته:</strong>
        <input type="checkbox" [checked]="suggestion.added" (click)="$event.preventDefault(); toggleAddedStatus(suggestion)" />
      </div>
      <div><strong>تاريخ الطلب:</strong> {{ formatOrderDate(suggestion.dateRequested) }}</div>
      <div class="mt-2">
        <button (click)="deleteRequestedBook(suggestion._id, suggestion.userId)" class="bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800 text-white px-3 py-1 rounded w-full">
          حذف
        </button>
      </div>
    </div>
  </div>

  <!-- Pagination controls for requestedBooks -->
  <div class="flex justify-center mt-4 space-x-4">
    <button (click)="requestedBooksPage = requestedBooksPage - 1; fetchRequestedBooks()" [disabled]="requestedBooksPage === 1" class="px-3 py-1 bg-gray-300 dark:bg-gray-600 rounded disabled:opacity-50">السابق</button>
    <span class="text-gray-900 dark:text-gray-200">صفحة {{ requestedBooksPage }}</span>
    <button (click)="requestedBooksPage = requestedBooksPage + 1; fetchRequestedBooks()" [disabled]="requestedBooks.length < requestedBooksPageSize" class="px-3 py-1 bg-gray-300 dark:bg-gray-600 rounded disabled:opacity-50">التالي</button>
  </div>
</div>

<!-- عرض طلبات الطباعة -->
<div *ngIf="currentView === 'printOrders'" class="px-2 sm:px-10">
  <h3 class="text-xl font-bold mb-4 text-gray-900 dark:text-gray-200">طلبات الطباعة</h3>
  <!-- Table for medium and larger screens -->
  <table class="min-w-full bg-white dark:bg-gray-800 rounded-lg shadow-md text-sm mx-auto hidden sm:table">
    <thead>
      <tr class="bg-blue-100 dark:bg-[#0a1325] text-blue-700 dark:text-blue-400 uppercase text-xs font-semibold">
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">بيانات المستخدم</th>
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">عنوان المشروع</th>
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">اسم الملف</th>
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">عدد الصفحات</th>
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">عدد النسخ</th>
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">نوع الغلاف</th>
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">لون الطباعة</th>
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">الحجم</th>
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">السعر المقدر</th>
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">تاريخ الطلب</th>
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">حالة الطلب</th>
        <th class="py-3 px-4 text-center border-b border-blue-200 dark:border-blue-700">إجراءات</th>
      </tr>
    </thead>
    <tbody *ngIf="printOrders.length > 0">
      <tr *ngFor="let printOrder of printOrders; let i = index" [ngClass]="{'bg-blue-50 dark:bg-[#0a1325]': i % 2 === 0, 'bg-white dark:bg-gray-800': i % 2 !== 0}">
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700 rtl">
          <div><strong>الاسم:</strong> {{ printOrder.username }}</div>
          <div><strong>البريد الإلكتروني:</strong> {{ printOrder.email }}</div>
          <div><strong>الهاتف:</strong> {{ printOrder.phone }}</div>
          <div><strong>العنوان:</strong> {{ printOrder.address }}</div>
        </td>
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">{{ printOrder.printProject.projectTitle }}</td>
<td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700" title="{{ printOrder.printProject.filename }}">
  {{ printOrder.printProject.filename.length > 20 ? (printOrder.printProject.filename | slice:0:17) + '...' : printOrder.printProject.filename }}
</td>
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">{{ printOrder.printProject.pages }}</td>
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">{{ printOrder.printProject.copies }}</td>
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">{{ printOrder.printProject.coverType }}</td>
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">{{ printOrder.printProject.printColor }}</td>
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">{{ printOrder.printProject.size }}</td>
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">{{ printOrder.printProject.estimatedPrice + ' ج.م' }}</td>
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">{{ formatOrderDate(printOrder.orderDate) }}</td>
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">
          <span class="inline-block px-2 py-1 rounded-full text-xs font-semibold" [ngClass]="{
            'text-yellow-500': printOrder.status === 'قيد الإنتظار',
            'text-orange-500': printOrder.status === 'تم الشحن',
            'text-green-500': printOrder.status === 'تم التسليم',
            'text-red-500': printOrder.status === 'تم الإلغاء',
            'dark:text-yellow-400': printOrder.status === 'قيد الإنتظار',
            'dark:text-orange-400': printOrder.status === 'تم الشحن',
            'dark:text-green-400': printOrder.status === 'تم التسليم',
            'dark:text-red-400': printOrder.status === 'تم الإلغاء'
          }">
            {{ printOrder.status }}
          </span>
        </td>
        <td class="py-2 px-3 text-center border-b border-blue-200 dark:border-blue-700">
          <div class="flex gap-2 mt-2">
            <a [href]="getDownloadUrl(printOrder)" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1 px-3 rounded text-center" download>
              تحميل الملف
            </a>
            <button
              *ngIf="printOrder.status === 'قيد الإنتظار'"
              (click)="confirmPrintOrderShipment(printOrder.userId, printOrder.orderId, 'تم الشحن')"
              class="w-full bg-orange-500 hover:bg-orange-600 dark:bg-orange-600 dark:hover:bg-orange-700 text-white font-semibold py-1 px-3 rounded"
            >
              اشحن
            </button>
            <button
              *ngIf="printOrder.status === 'تم الشحن'"
              (click)="confirmPrintOrderShipment(printOrder.userId, printOrder.orderId, 'تم التسليم')"
              class="w-full bg-green-500 hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700 text-white font-semibold py-1 px-3 rounded"
            >
              تمت
            </button>
            <button
              *ngIf="printOrder.status !== 'تم الإلغاء' && printOrder.status !== 'تم التسليم'"
              (click)="confirmPrintOrderShipment(printOrder.userId, printOrder.orderId, 'تم الإلغاء')"
              class="w-full bg-red-700 hover:bg-red-800 dark:bg-red-700 dark:hover:bg-red-800 text-white font-semibold py-1 px-3 rounded"
            >
              إلغاء
            </button>
            <button (click)="deletePrintOrder(printOrder.userId, printOrder.orderId)" class="w-full bg-gray-700 hover:bg-black dark:bg-gray-800 dark:hover:bg-black text-white font-semibold py-1 px-3 rounded">
              حذف
            </button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

<!-- List for small screens -->
  <div class="sm:hidden space-y-4">
    <div *ngFor="let printOrder of printOrders; let i = index" [ngClass]="{'bg-blue-50 dark:bg-[#0a1325]': i % 2 === 0, 'bg-white dark:bg-gray-800': i % 2 !== 0}" class="rounded-lg p-4 shadow-md dark:shadow-lg rtl">
      <div><strong>الاسم:</strong> {{ printOrder.username }}</div>
      <div><strong>البريد الإلكتروني:</strong> {{ printOrder.email }}</div>
      <div><strong>الهاتف:</strong> {{ printOrder.phone }}</div>
      <div><strong>العنوان:</strong> {{ printOrder.address }}</div>
      <div><strong>عنوان المشروع:</strong> {{ printOrder.printProject.projectTitle }}</div>
      <div><strong>اسم الملف:</strong> {{ printOrder.printProject.filename }}</div>
      <div><strong>عدد الصفحات:</strong> {{ printOrder.printProject.pages }}</div>
      <div><strong>عدد النسخ:</strong> {{ printOrder.printProject.copies }}</div>
      <div><strong>نوع الغلاف:</strong> {{ printOrder.printProject.coverType }}</div>
      <div><strong>لون الطباعة:</strong> {{ printOrder.printProject.printColor }}</div>
      <div><strong>الحجم:</strong> {{ printOrder.printProject.size }}</div>
      <div><strong>السعر المقدر:</strong> {{ printOrder.printProject.estimatedPrice + ' ج.م' }}</div>
      <div><strong>تاريخ الطلب:</strong> {{ formatOrderDate(printOrder.orderDate) }}</div>
      <div class="mt-2 flex gap-2">
        <a [href]="backendBaseUrl + '/uploads/' + encodeUriComponentSafe(extractFilename(printOrder.printProject.filepath))" download class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1 px-3 rounded text-center">
          تحميل الملف
        </a>
        <button (click)="deletePrintOrder(printOrder.userId, printOrder.orderId)" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-semibold py-1 px-3 rounded">
          حذف
        </button>
      </div>
    </div>
  </div>

  <!-- Pagination controls for printOrders -->
  <div class="flex justify-center mt-4 space-x-4">
    <button (click)="printOrdersPage = printOrdersPage - 1; loadPrintOrders()" [disabled]="printOrdersPage === 1" class="px-3 py-1 bg-gray-300 dark:bg-gray-600 rounded disabled:opacity-50">السابق</button>
    <span class="text-gray-900 dark:text-gray-200">صفحة {{ printOrdersPage }}</span>
    <button (click)="printOrdersPage = printOrdersPage + 1; loadPrintOrders()" [disabled]="printOrders.length < printOrdersPageSize" class="px-3 py-1 bg-gray-300 dark:bg-gray-600 rounded disabled:opacity-50">التالي</button>
  </div>
</div>